require(["jquery","plupload","qiniu"],function(t){function e(){var e=t(".name").data("uid");return e}function n(e){t("#edit-avatar").attr("src",e)}function a(n){t.ajax({url:"/update/avatar/"+e(),type:"PUT",data:{avatar:n},success:function(t,e){console.log(t)}})}Date.prototype.format=function(t){var e={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(t)&&(t=t.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in e)new RegExp("("+n+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?e[n]:("00"+e[n]).substr((""+e[n]).length)));return t};var o=(location.pathname,"1MB"),i="http://img.aixunbang.com/",r="/get/qiniu/uptoken";Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"edit-avatar",uptoken_url:r,get_new_uptoken:!1,multi_selection:!1,domain:i,max_retries:1,dragdrop:!1,drop_element:"imgbox",chunk_size:"4mb",auto_start:!0,filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}],max_file_size:o},init:{QueueChanged:function(t){},FileUploaded:function(e,o,r){console.log(r);var u=t.parseJSON(r);console.log(u.key);var l=i+u.key;n(l),a(l)},Error:function(t,e,n){e&&e.code==plupload.FILE_SIZE_ERROR?alert("图片大小超过"+o+"了"):e&&e.code==plupload.FILE_EXTENSION_ERROR&&alert("当前选择的文件不符合要求,请检查要上传的文件是否为jpg/png/jpeg")},UploadComplete:function(){},Key:function(t,e){var n=(new Date).format("yyyy-MM-dd"),a=Date.now().toString(),o="."+e.name.split(".")[1],i="avatar/"+n+"/"+a+o;return i}}})});