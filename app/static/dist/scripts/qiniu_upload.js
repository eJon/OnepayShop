require(["jquery","plupload","qiniu"],function(e){Date.prototype.format=function(e){var t={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(this.getFullYear()+"").substr(4-RegExp.$1.length)));for(var n in t)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1==RegExp.$1.length?t[n]:("00"+t[n]).substr((""+t[n]).length)));return e};var t=(location.pathname,"10MB"),n="http://img.aixunbang.com/",i="/get/qiniu/uptoken";Qiniu.uploader({runtimes:"html5,flash,html4",browse_button:"pickfiles",uptoken_url:i,get_new_uptoken:!1,multi_selection:!1,domain:n,max_retries:1,dragdrop:!1,drop_element:"imgbox",chunk_size:"4mb",auto_start:!0,filters:{mime_types:[{title:"Image files",extensions:"jpg,jpeg,png"}],max_file_size:t},init:{QueueChanged:function(e){},FilesAdded:function(e,t){},FilesRemoved:function(e,t){},BeforeUpload:function(e,t){},UploadProgress:function(e,t){},FileUploaded:function(t,i,o){console.log(o);var l=e.parseJSON(o);console.log(l.key);var r=n+l.key;e("#thumbnail").length>0&&(e("#thumbnail").val(r),e(".preview-img").attr("src",r))},Error:function(e,n,i){n&&n.code==plupload.FILE_SIZE_ERROR?alert("图片大小超过"+t+"了"):n&&n.code==plupload.FILE_EXTENSION_ERROR&&alert("当前选择的文件不符合要求,请检查要上传的文件是否为jpg/png/jpeg")},UploadComplete:function(){},Key:function(e,t){var n=(new Date).format("yyyy-MM-dd"),i=Date.now().toString(),o="."+t.name.split(".")[1],l="thumbnail/"+n+"/"+i+o;return l}}});e(".pickfiles").on("click",function(){return!1})});