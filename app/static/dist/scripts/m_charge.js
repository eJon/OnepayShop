require(["jquery","pingpp-js"],function(n,a){function t(){var n=!1;return i.amount>0&&"微信"==i.pay_method&&"wx_pub"==i.channel?n=!0:e.show("表单错误","请选择充值数量或支付方式"),n}n(".go-back").on("click",function(){history.back()});var e={show:function(a,t){var e=n("#tips_dialog");e.find(".weui_dialog_hd").text(a),e.find(".weui_dialog_bd").text(t),n("#tips_dialog").show()},bind:function(){n("#tips_dialog").on("click",".weui_btn_dialog",function(){n("#tips_dialog").hide()})}};e.bind();var i={amount:10,pay_method:"微信",channel:"wx_pub",charge_type:"充值"};n('input[name="count"]').on("change",function(){var a=n(this);console.log(a.val()),"NaN"!=Number(a.val()).toString()&&(i.amount=Number(a.val()))}),n(".other-input").on("keyup",function(){var a=n(this);1==a.val().length?a.val(a.val().replace(/[^1-9]/g,"1")):a.val(a.val().replace(/\D/g,"1")),"NaN"!=Number(a.val()).toString()&&(i.amount=Number(a.val()))}),n('input[name="methods"]').on("change",function(){i.pay_method=n(this).val(),i.channel=n(this).data("channel")}),n("#submit-btn").on("click",function(){n(this).attr("disabled",!0),n(this).addClass("weui_btn_disabled"),t()&&n.post("/charge",i,function(t,i){"success"==i&&t&&("创建订单失败"==t||"订单数据不合法"==t?(n(this).attr("disabled",!1),n(this).removeClass("weui_btn_disabled")):(console.log(t),a.createPayment(t,function(a,i){if("success"==a){var o=JSON.parse(t),l="/charge/result/"+o.order_no;n.get(l,function(n){n.status&&location.replace("/pay/result?para="+o.order_no)})}else"fail"==a?e.show("支付结果","支付失败,请尝试重新提交订单"):"cancel"==a&&console.log("取消付款")})))})})});